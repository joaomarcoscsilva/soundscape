FROM nvidia/cuda:11.3.0-cudnn8-devel-ubuntu20.04

ARG DEBIAN_FRONTEND=noninteractive

ENV NV_CUDNN_VERSION 8.5.0.96
ENV NV_CUDNN_PACKAGE_NAME "libcudnn8"

ENV NV_CUDNN_PACKAGE "libcudnn8=$NV_CUDNN_VERSION-1+cuda11.7"
ENV NV_CUDNN_PACKAGE_DEV "libcudnn8-dev=$NV_CUDNN_VERSION-1+cuda11.7"

RUN apt-get update 

ENV TERM xterm-256color

RUN apt-get update -y && apt-get install -y \
	software-properties-common \
	build-essential \
	libblas-dev \
	libhdf5-serial-dev \
	git

RUN apt-get -y install tmux git htop zsh neovim curl

RUN apt-get -y install python3.9 python3-pip
RUN ln -s /usr/bin/python3.9 /usr/bin/python
RUN ln -f -s /usr/bin/python3.9 /usr/local/bin/python
RUN python -m pip install -U pip

# Installs jax
RUN pip install --upgrade pip
RUN pip install --upgrade "jax[cuda]" -f https://storage.googleapis.com/jax-releases/jax_cuda_releases.html

WORKDIR /root

ENV XLA_PYTHON_CLIENT_MEM_FRACTION 0.7
RUN sh -c "$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"

COPY requirements.txt requirements.txt
RUN pip install -r requirements.txt

WORKDIR /home/jmsilva

RUN git config --global --add safe.directory /home/jmsilva/soundscape
RUN git config --global user.email joaomarcoscsilva@usp.br
RUN git config --global user.name "Jo√£o Marcos Cardoso da Silva"

CMD zsh
